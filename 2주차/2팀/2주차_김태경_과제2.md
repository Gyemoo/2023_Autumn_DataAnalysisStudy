데이터 필터링, 정렬, 결측값, 이상값 처리
=================
!!! 이하 내용은 기본적으로 다음의 코드가 작성되었음을 기준으로 합니다.

    import numpy as n
    import pandas as p
    import seaborn as s
    p = s.load_dataset('penguins')

# 1. 데이터 필터링, 정렬 테크닉
## 1-1. 조건식을 이용한 데이터 필터링
지금까지 우리는 함수를 이용해 데이터를 추출했다. 하지만, 조금 비효율적일지언정 함수 없이도 조건식으로 데이터 추출이 가능한 방법이 있다.
### 단일 조건식에서
+ 원하는 컬럼명과, 그 컬럼명에서의 원하는 데이터를 대괄호 안에 넣는 방법으로 해당 데이터가 있는 값만 추출이 가능하다. ==으로 해당 데이터만, !=으로 해당 데이터 빼고 나머지만 추출이 가능하다.

    p[p.species=="Gentoo"].head()

### 다중 조건식에서
+ 단일 조건식의서의 경우와 기본적으로 동일하다. 각 조건식을 소괄호 안에 넣고 소괄호와 소괄호를 &으로 연결해주면 된다.

    p[(p.species=="Gentoo") & (p.sex==Male)].head()

## 1-2. loc 조건부 필터 
loc 함수나 iloc 함수를 사용해서도 필터링이 가능하다.
+ loc 함수를 사용하는 경우 다음과 같다.

    p.loc[p.body_mass_g>=4000, :]

+ iloc 함수를 사용하는 경우 다음과 같다.

    p.loc[list(p.body_mass_g>=4000)]

+ 조건이 여러개면 아까랑 똑같이 소괄호 씌우고 &으로 연결하면 된다.

## 1-3. 특정 값 포함 여부 필터링
isin() 함수를 활용해 원하는 값이 들어간 데이터만 뽑아낼 수 있다. 다음과 같은 방법으로 활용할 수 있다. 위는 원하는 것만, 아래는 원하는것 빼고 다 찾는 코드이다.

    p[p.species.isin(["Adelie", "Gentoo"])].head()
    p[~p.species.isin(["Adelie", "Gentoo"])].head()

+ 여러 개를 사용하는 경우 각각의 isin 함수를 쓴 상태의 데이터를 변수에 담고, 그 변수들을 &으로 연결해 쓰면 된다.

## 1-4. 쿼리를 이용한 데이터 필터링
뭐니뭐니해도 가장 간단한 것은 query() 함수 사용이다. 다음과 같은 방법으로 사용 가능하다.

    p.query('species == "Gentoo" & body_mass_g>=4000')

이런 식이다. 조건이 몇개건, 어떻건 작성하고 &로 연결해놓기만 하면 다 된다. 참고로 isin처럼 변수로 만들어서 이어도 무방하다.

## 1-5~6. 그 외 기타등등
+ 결측값(=널값)이 있는 경우는 .notnull()을 붙이면 결측값 없는 데이터만 선택된다.
+ 특정 문자가 들어있는 것만 확인하고 싶다면 뒤에 .str.contains('문자') 해주면 된다.

## 1-7. 데이터 정렬
가장 기본적인 데이터 정렬 방법은 sort_values() 함수를 쓰는 것이다. 이는 다음과 같은 방식으로 작동한다. 2개 이상의 컬럼을 기준으로 정렬한다면 왼쪽부터 우선순위가 높은 순서대로 ,로 구분하면 된다.

    p.sort_values(by=['기준이 될 컬럼명'], ascending=오름차순은 트루 내림차순은 펄스).head(5)

그 외에도 nlargest() 등을 이용해 정렬을 할 수 있다.

## 1-8. 데이터 뒤집기
.loc[::-1] 붙이면 row가 뒤집어진다.
.loc[:, ::-1]을 붙이면 column이 뒤집어진다.

# 2. 결측값 처리하기
사이즈가 안맞거나 빈칸이 있는 등 결측값이 있으면 데이터 처리가 곤란해진다. 따라서 다음과 같은 2가지 해결 방안이 있다.

하나는 그냥 결측값이 있는 행을 통으로 지우기. 이렇게 하면 데이터 손실이 하나 생긴다.

다른 하나는 결측값을 다른걸로 대체하기. 이건 우리가 유추해야 해서 살짝 부정확할 수 있다.

## 2-1~3. 일단 결측값을 보자
+ 시본 라이브러리에 있는 heatmap() 함수를 사용해 결측값 위치만 볼 수 있다.

    s.heatmap(p.isnull(), cbar=False)

+ 판다스의 .info() 함수로 결측값이 어떤 컬럼에 몇개 있는지 확인할 수 있다.

    p.info()

여기서 나오는 결과에서 인덱스 길이보다 작게 나오면 그 수만큼 결측값이 있다는 소리다.
+ .isna() 또는 .isnull()함수로 결측값 유무를 확인할 수 있다. 보통은 여기다 .sum()을 조합해서 지정 데이터 기준으로 확인 가능하게 쓴다.

    p.isna().sum()

이러면 데이터셋 전체가 기준이 된다. 컬럼 한개만 보고 싶으면 isna 쓰기 전에 컬럼명을 넣자.

+ isna랑 반대로 notna를 쓰면 정상인 값의 수가 나온다.
## 2-4. 결측값 지워버리기
+ p.dropna()를 쓰면 결측값이 하나라도 있는 행을 편하게 통으로 날릴 수 있다.
  + 컬럼축을 기준으로 하고싶다면 괄호 안에 axis='columns' 넣으면 된다.
  + 결측값 수가 일정 수 이상이면 지우게 할 수 있다. 괄호 안에 how='any 아니면 all' 넣거나, thresh=숫자 넣으면 된다.
  + 특정 컬럼만 빈 행을 지우려면 괄호 안에 subset=['컬럼명'] 넣으면 된다.
## 2-5. 결측값 바꿔버리기
+ p.fillna()를 쓰면 결측값을 원하는 값으로 싹다 채울 수 있다. 괄호 안에는 원하는 숫자 넣으면 되고, 원하는 컬럼만 채우려면 .앞에 컬럼명 적자.
  + 원하는 숫자가 전후 값이랑 같을 경우 괄호 안에 method="앞이면 ffill 뒤면 bfill" 넣으면 된다.
+ replace()를 쓸 수도 있다. 괄호 안에 to_replace=n.nan, value=원하는거 넣으면 된다.

# 3. 이상값(잘못된 값) 처리
간혹 이상값이 있어 연산이 잘못될 수도 있다. 이러한 경우 다음과 같이 해결이 가능하다.
## 3-2. 이상값 시각화하기
보통은 박스플롯이나 히스토그램을 쓴다. 2개 이상의 변수에 대해서라면 산점도도 많이 사용된다.
+ 박스플롯의 경우 데이터를 4등분하는 사분위수를 활용한다. 박스의 양 옆이 25%와 75%, 중앙이 50%, 맨 끝들이 0%와 100%다. 0%와 100% 바깥의 값들이 바로 이상값들이다.
## 3-3. IQR 기법
IQR 기법은 이상값을 탐지하는 가장 좋은 방법 중 하나이다. 이는 사분위수 함수를 이용해 정의하고 사용할 수 있다. 다음과 같은 방법으로 작동한다.

1. 25% 수 Q1을 찾고
2. 75% 수 Q3을 찾고
3. Q3-Q1을 구한다.

## 3-4. 이상값 처리하기
결측값처럼 이상값도 그냥 지워버리거나 대체하는 것으로 해결이 가능하다.
+ 이상값을 제외한 정상값 범위 내에서만 재정의하면 이상값 삭제가 가능하다.
+ 이상값 부분만 찾아서 그 부분에 다른 값을 넣으면 대체가 가능하다.
+ 보면 알겠지만, 이 부분은 IQR 함수가 라이브러리 내 따로 정의되어있지 않기 때문에 수동이다.

인상깊은 코드와 활용법
-----------------
가장 인상깊은 것은 필터링을 가장 간편하게 해주는 query 함수이다. 원하는 조건이 어떻든, 몇개건 상관없이 다 넣어서 한번에 쓸 수 있고, 심지어 코드로 보기에도 조건이 직관적이라는 점도 매력적이다.

dropna와 fillna 함수도 기억에 남는다. 이전에 길이가 다른 두 넘파이 배열을 데이터셋으로 만드는 것에 대해 상완이형의 문제를 푼 적 있는데, 그때 문제를 내가 잘못 이해한 방향에 대해서 맞는 답을 찾았다고 생각한다. 결측값을 한번에 정리해버릴 수 있어서 자주 애용할 것 같다.

느낀점
---------------
구글 코랩도 그렇고, 내가 기존에 쓰던 환경과는 완전히 다른 새로운 환경과 내용을 배우다보니 처음엔 난해했던 것 같다. 점점 내가 사용을 많이 해봄에 따라 이제는 어느 정도 눈에 익기도 하고, 앞으로 더 공부하게 되면 함수들을 자유자재로 사용할 수 있는 날이 올 것이다.
